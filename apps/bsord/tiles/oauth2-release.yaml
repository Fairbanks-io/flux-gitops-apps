apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    k8s-app: oauth2-proxy
  name: oauth2-proxy
  namespace: tiles
spec:
  replicas: 1
  selector:
    matchLabels:
      k8s-app: oauth2-proxy
  template:
    metadata:
      labels:
        k8s-app: oauth2-proxy
    spec:
      containers:
      - args:
        - --email-domain=*
        - --upstream=file:///dev/null
        - --http-address=0.0.0.0:4180
        env:
        - name: OAUTH2_PROXY_CLIENT_ID
          valueFrom:
            secretKeyRef:
              name: oauth2-secret
              key: clientId
        - name: OAUTH2_PROXY_CLIENT_SECRET
          valueFrom:
            secretKeyRef:
              name: oauth2-secret
              key: clientSecret
        # docker run -ti --rm python:3-alpine python -c 'import secrets,base64; print(base64.b64encode(base64.b64encode(secrets.token_bytes(16))));'
        - name: OAUTH2_PROXY_COOKIE_SECRET
          valueFrom:
            secretKeyRef:
              name: oauth2-secret
              key: cookieSecret
        image: quay.io/oauth2-proxy/oauth2-proxy:latest
        imagePullPolicy: Always
        name: oauth2-proxy
        ports:
        - containerPort: 4180
          protocol: TCP
---
apiVersion: v1
kind: Service
metadata:
  labels:
    k8s-app: oauth2-proxy
  name: oauth2-proxy
  namespace: tiles
spec:
  ports:
  - name: http
    port: 4180
    protocol: TCP
    targetPort: 4180
  selector:
    k8s-app: oauth2-proxy
---
apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: oauth2-proxy
  namespace: tiles
spec:
  rules:
  - host: auth.popcan.io
    http:
      paths:
      - backend:
          serviceName: oauth2-proxy
          servicePort: 4180
        path: /oauth2
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  creationTimestamp: null
  name: oauth2-secret
  namespace: tiles
spec:
  encryptedData:
    clientId: AgCWewmno1NTNX/sGBU43Ti5bGJ3mgPSqfDJRlPyLztg8EkBVqmMEYB0XR6QGTKFdkZRjUdj7UVNrkbBwpCOCnhfXQW5aF+CgEJbABb9hIHvliFTVX4NZS9F/VMP1DEvNuWhMsfoja1J/7zxsqAJ+k/0SKbTvyINVhaU1wccNBCf8XNk/rzeIP6vbAOT0DQMAhDOrMH95Q88OERMLyRaiGqTyibJQJch0o6IdrQAX98jdc/0vTCUtj6EcM9BPerBujCkjbGgylr5Bzqe9nWLea5EppSiKvHChS+FyP4udJDYand8dO0m/Es/CzaRfREQavDDL/ukPd0/dsmjIUt6zGyjrCbfDgl2q0ecrAKPseJPQGwn1JG/244tYtwOWfv25Jyzs2WNiIVWw8nDUE6mV4AJ3x3F8i0pOchEkOTXlMMraJxg5q6M4Ghd9TB6g5JSwnIUz3Qp4KbAjVTj+ZjSjl5h5K1SZtFRJI3RydGX3PGdpCUelh713jpBkixE/WTETQtxMMAZEd9Xzh1vn3X6gwFoYjhAZIJjYHBbbJUhBZAyiY8sycvEaxZVbK72A9BGodWggz9+dTEUw6NxnwSr3uIOz1l+VWks5ktd8EaxVZKhyP4N1JNSOAnsBBUcldlNdS1Imeyc5YUkas24Ic0EXZbTTG8QET9lgQ3tkZEdyysCvGhVde96dWIamEC+GbEs6srT2P4aEUxvLKCXF9LN2F2qEy9OjVOrJhD8g3O3gW5uyqzlsqg8SMm7GflVyvi0Sox115uM5+6DukhDm77mYsCOmqgoAS2L+Jw=
    clientSecret: AgBAtZfDNNSe+OgpqtlcJPkF5C2+YIDgTKRMXNUsmuCJ7aot2IruOEhrgnrLxnzHC+sPlVZOsAft19fkLPFiWDfmz1C+pVCOhEw/byPWkbGHPQFpiYDvunzqBdFm1+d68kWC6lBW1IcjKT1BiXNoLrIgHN8VsusmMqjXauzcXhQ/frDR4Zo150ZUt5ytrStkrsh3NaeIvUtuoDL5+MJKfGlnIZRDDr/Ju2K6IcQx8zFIdZXQMZmOj/JREdgi8ArTVC8K1mEOI4BxjGgyPeBw5nrivvpWf6vxdocpD/UQFVrenXPJRRY4h0Oh7MYnfehPLsBE8bbJgkkokrVM2GxFSunO4haqYWohi6yfhnAtt4276mo5OxlT90Vq5/aXtR1CgMykXTwSFHvjdQBDTSXey0fXrt+P896zS8bJvJ5cag/Ei4T/BxflV6rJ065j0S6+wPzWngkDLIqkXZCvKYW+ldZOJMHzvb2PL9oRESKoRgJogrv7Yt+7WXGRD0CsUOEmmP8gw7GdnhHxwiBQdmQYDhOLJR2VIAaV9FDY59Xahjed9Q2Jwi7uB5HgelHCuR1DnJQwpD5yexdPH1+VIa/rqwhEmBF5B+9I1Ho0KkZc0IYgMv5fyp90U1S6xKla8LBnam6CkKgpaPcTrtvBopzig52tL9XReNaEJfYLG4mD3unxY641CsC0nhx5zku0E6N+btz5/YuMcAZybQ4PIGViEuQVpWxUz2qeScM=
    cookieSecret: AgApbx3Da37GloXnFYhL5HB3dkFqdvKKkrc1acyywEn4rbo0hlrwFKO+otnMOndWVR3q29+FEtyQ8OFZoG0b5IEuT2iRNHmsDOyv+Jpx8lwFPRdDWcXPl4j0pX3wd7S6maYWxE0hzgUCOLZi9bOe8a5PtVsLIFn7PzdZk908UO+tJLU1Tk/0FVcHntkBW/0gWBful+nqeSZXYLfIRiPEmS3K2oaQuFJodJGMKivydOjDD70qGKUcwThVkaoEsrMW+aS3VKSDEz3UyM2NEAP65moRMa3miefz6tpJlQNnlkmRR/h3pSB7FXKo9H7F1NfT4DF6z+//jb6QOKNrOuejzQEyuKW+7UouE44Tlr5YdmvCHwIsaBRVzpTGjx/bXlkMyDMb5gNAhAeH+PQRc00bCBSBWhTu7dnmpgzCyfpzBTqhrLEeMPYT3IeYk+yA92LLPbRvRH1h5gL2CuNj/FyOiTh24XLxtrYXFZ8ihlFKwfco/6Ch27WEEoX+MsTMYxmsUy40rJWZaszvKv+kvqSmutnfBcZDMWzTxwZ0UAIT6r6g2tUPHMzUeH9RDujH34f07zaVe6OANOZdo+6wvffDHXlRVDyC06yVf04ip4q/H5TCl6Gmg71qIatzGulidmioxX5/F4kXh0OrUe9gxg5G6rGKOM4rSepyiJPBihGO18um6lpdNrMEvrogb9FxxkrUb/6ZDTpCB1KL7x4jhMOZFjDcHcGSJsKWkRI=
  template:
    metadata:
      creationTimestamp: null
      name: oauth2-secret
      namespace: tiles
status: {}